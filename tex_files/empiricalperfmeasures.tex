\section{(Limits of) Empirical Performance Measures}
\label{sec:limits-of-emperical}



\opt{solutionfiles}{
\subsection*{Theory and Exercises}
\Opensolutionfile{hint}
\Opensolutionfile{ans}
}

If the arrival and service processes are such that the queueing system is rate-stable, we can sensibly define other performance measures such as the average waiting time.
In this section we define the second most important performance measures; recall that the most important is the utilization $\rho$.
At the end we provide an overview of the relations between these performance measures in Figure~\ref{fig:constructiongg1}.


With the construction of queueing processes in Section~\ref{sec:constr-gg1-queu} we can compute the waiting time as observed by the first $n$, say, jobs.
%Thus, the average waiting time of the first $n$ arrivals is given by $n^{-1}\sum_{k=1}^n W_k$.
We therefore define the \recall{expected waiting time} as
\begin{equation}\label{eq:49}
  \E W = \lim_{n\to\infty} \frac 1n\sum_{k=1}^n W_k,
\end{equation}
and the expected time in queue as
\begin{equation}\label{eq:50}
  \E{W_Q} = \lim_{n\to\infty} \frac 1 n\sum_{k=1}^n W_{Q,k}.
\end{equation}
Note that these performance measures are limits of \emph{empirical} measures.
Note also that these statistics are as \emph{observed by arriving jobs}: the first job has a waiting time $W_1$ at its arrival epoch, the second a waiting time $W_2$, and so on.
For this reason we colloquially say that $\E W$ is the average waiting time as `seen by arrivals'.
The \emph{distribution of the waiting times at arrival times} can be found by counting:
\begin{equation}\label{eq:48}
  \P{W \leq x}  = \lim_{n\to\infty} \frac 1n\sum_{k=1}^n \1{W_k\leq x}.
\end{equation}
Finally, the (sample) \recall{average number of jobs} in the system as seen by arrivals is given by
\begin{equation}\label{eq:EQ}
\E L =  \lim_{n\to\infty}\frac 1 n \sum_{k=1}^n L(A_k-),
\end{equation}
where $L(A_k-)$ is the number of jobs in the system at the arrival epoch of the $k$th job.
The \emph{distribution of $\{L(t)\}$as seen by customers upon arrival}, is
\begin{equation}\label{eq:Qm}
\P{L\leq m} = \lim_{n\to\infty} \frac 1 n \sum_{k=1}^n \1{L(A_k-) \leq m}.
\end{equation}


A related set of performance measures follows by tracking the system's behavior over time and taking the \emph{time-average}, rather than the average at sampling (observation) moments.
% Thus, if we simulate the queueing system up to time $t$, 
% \begin{equation}\label{eq:11}
% \frac 1 t\int_0^t L(s)\d s =  \frac 1 t\int_0^t (A(s)-D(s)) \d s,
% \end{equation}
% where we use that $L(s)=A(s) - D(s) + L(0)$ is the total number of jobs in
% the system at time $s$ and $L(0)=0$, cf. Figure~\ref{fig:atltdt}.  Observe from the second equation that $\int_0^t L(s)\d s$ is the area enclosed between the graphs of $\{A(t)\}$
% and $\{D(t)\}$. 
Assuming the limit exists we use~\eqref{eq:14} to define the \recall{time-average number of jobs} as
\begin{equation}
  \label{eq:46}
  \E L = \lim_{t\to\infty} \frac 1 t\int_0^t L(s) \d s.
\end{equation}
Observe that, notwithstanding that the symbols are the same, this expectation need not be the same as~\eqref{eq:EQ}.
In a loose sense we can say that $\E L$ is the average number in the system as perceived by the \emph{server}.
Next, define the \emph{time-average fraction of time the system contains at most $m$ jobs} as
\begin{equation}
  \label{eq:47}
  \P{L\leq m} =\lim_{t\to\infty} \frac 1 t\int_0^t \1{L(s)\leq m} \d s.
\end{equation}
Again, this probability need not be the same as what customers see upon arrival.


\begin{exercise}
Design a queueing system to show that average number of jobs in the system as seen by the server can be very different from what the customers see.
  \begin{hint}
Consider a queueing system with constant service and inter-arrival times.
  \end{hint}
\begin{solution}
  Take $X_k = 10$ and $S_k = 10-\epsilon$ for some tiny
  $\epsilon$. Then $L(t) = 1$ nearly all of the time. In fact,
  $\E L = 1-\epsilon/10$. However, $L(A_k-)=0$ for all $k$.
\end{solution}
\end{exercise}



\begin{exercise}
  Consider a discrete-time model of a queueing system, as we developed in Section~\ref{sec:constr-discr-time}.
  The average number of customers that \emph{see upon arrival} more than~$m$ customers in the system cannot be defined as~\eqref{eq:Qm}.
  Provide a better definition.
  \begin{hint}
    Why is \eqref{eq:Qm} not the same as the number of batches that see a queue length less than~$m$?
  \end{hint}
  \begin{solution} Since we deal with a system in discrete time, $L_k$ is the queue length at the end of period~$k$.
    Thus, $\sum_{k=1}^n \1{L_k > m}$ counts the number of \emph{periods} that the queue is larger than $m$.
    This is of course not the same as the number of \emph{jobs} that see a queue larger than $m$; only when $a_k>0$ the customers in a batch would see a queue $L_k>m$.
    Thus,
    \begin{equation*}
      \sum_{k=1}^n \1{L_k > m} \1{a_k > 0},
    \end{equation*}
    counts the number of batches. 

    Next, by assumption, $a_k$ customers arrive during period $k$.
    The first of these customers sees a queue length of $L_{k-1} - d_k$, the second $L_{k-1}-d_k + 1$, and so on until the last customer who sees a queue length of $L_{k-1} - d_k + a_k -1 = L_k -1$.
    Thus, of all jobs the last sees the largest queue.
    Hence, if $L_k \leq m$, all customers of the batch see a queue less than $m$.
    If, however, $L_k > m$, then $L_k -m$ customers saw $m$ or more jobs in the system.
    Therefore, the fraction of arrivals that see a queue with $m$ or more jobs is equal to
\begin{equation*}
  \frac 1 {A(n)} \sum_{k=1}^n (L_k - m) \1{L_k > m} .
\end{equation*}
We could also define this a bit differently.
Suppose that we don't want to distinguish between jobs in a batch, but simply want to say that if one job sees a long queue, all see a long queue.
In that case,
\begin{equation*}
\frac 1{A(n)}\sum_{k=1}^n a_k \1{L_k > m}.
\end{equation*}
Thus, when jobs arrive in batches, the definition of loss fraction requires some care; not all definitions need to measure the same.
  \end{solution}
\end{exercise}




\opt{solutionfiles}{
\Closesolutionfile{hint}
\Closesolutionfile{ans}
\subsection*{Hints}
\input{hint}
\subsection*{Solutions}
\input{ans}
}


%\clearpage
  



%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../queueing_book"
%%% End:
