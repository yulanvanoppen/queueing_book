\section{Applications and Useful Identities}
\label{sec:some-usef-ident}


\subsection*{Theory and Exercises}

\opt{solutionfiles}{
\Opensolutionfile{hint}
\Opensolutionfile{ans}
}

With the PASTA property and Little's law we can derive a number of
useful and simple results for the $M/G/1$ queue by which we can analyze a large number of practical queueing situations, see Exercise~\ref{exer: Hall} and below. In particular, we derive expressions for  the following performance measures: server utilization, i.e., $\rho$, average queue length and waiting times. We assume that jobs arrive in accordance to a Poisson process so that we can use the PASTA property.


The fraction of time the server is empty is $1-\rho = p(0)$. By PASTA,
$\pi(0)=p(0)$, hence the fraction of customers that enter an empty
system is also $1-\rho$. Similarly, the fraction of customers that find the server occupied at arrival is equal to the utilization $\rho$. 


The average waiting time $\E W$ in the entire system is of course the expected time in queue plus the expected time in service, i.e., 
\begin{equation*}
  \E W = \E{W_Q}+ \E S.
\end{equation*}

To find an expression for $\E{W_Q}$ we need the concept of expected \recall{remaining service time} $\E{S_r}$ which is defined as the expected time it takes to complete the job in service at the time a job arrives.
In Section~\ref{sec:mg1} we give a precise meaning to this idea.

\begin{exercise}[\faFlask]\label{ex:32}
Show for the $M/G/1$ queue  that the expected time in queue is
\begin{equation}\label{eq:24}
  \E{W_Q} = \E{S_r} + \E{L_Q} \E S.
\end{equation}
\begin{hint}
  What happens when you enter a queue? First you have to wait until the job in service (if there is any) completes, and then you have to wait for the queue to clear.
\end{hint}
\begin{solution}
It is evident that the expected waiting time for an arriving customer is the expected
remaining service time plus the expected time in queue. The expected
time in queue  must be equal to the expected number of
customers in queue at an arrival epoch times the expected service time
per customer, assuming that service times are i.i.d. If the arrival
process is Poisson, it follows from PASTA that the average number of
jobs in queue perceived by arriving customers is also the
\emph{time-average} number of jobs in queue~$\E{L_Q}$.  
\end{solution}
\end{exercise}


\begin{exercise}($M/G/1$)
Use  the PASTA property to show that 
\begin{equation}\label{eq:37}
\E{S_r} =  \rho \E{S_r\given S_r>0}.
\end{equation}
\begin{hint}
Use Exercise~\ref{ex:28}.
a free server.  
\end{hint}
\begin{solution}
By the PASTA property we know that $\rho$ is  the probability to find the server busy upon arrival; hence $1- \rho$ is the probability that the server is idle upon arrival. Then,
\begin{equation*}
\E{S_r} =   \rho \E{S_r\given S_r >0} + (1-\rho) \E{S_r\given S_r = 0} = \rho \E{S_r\given S_r>0},
\end{equation*}
since, evidently, $\E{S_r\given S_r=0}=0$.  
\end{solution}
\end{exercise}

\begin{exercise}
  It is an easy mistake to think that $\E{S_r} = \E S$ when service
  times are exponential. Why is this wrong?
  \begin{hint}
Realize again that $\E{S_r}$ includes the jobs that arrive at an empty system.
  \end{hint}
  \begin{solution}

    $\E{S_r \given S_r>0} = \E S$ for the $M/M/1$ queue, and
    $\E{S_r} = \rho \E{S_r \given S_r>0}$ for the $M/G/1$ queue, it
    follows that
  \begin{equation*}
 \E{S_r} = \rho \E{S_r\given S_r>0} = \rho \E S.
  \end{equation*}
  \end{solution}
\end{exercise}

\begin{exercise}
  What would you guess for $\E{S_r\given S_r>0}$ for the $M/D/1$ queue? 
  \begin{solution}
    Since the service times are deterministic (and constant), I would
    guess that on average half of the service time remains at the
    moment a job arrives. If the service time is $D$ always, then
    $\E{S_r\given S_r>0} = D/2$.  
  \end{solution}
\end{exercise}


\begin{exercise}[\faCalculator]
  Use Exercise~\ref{ex:32} and Little's law to derive for the $M/G/1$ queue that 
\begin{equation}\label{eq:35}
  \E{W_Q} = \frac{\E{S_r}}{1-\rho}.% = \frac{\rho}{1-\rho} \E{S_r\given S_r>0}.
\end{equation}
\begin{hint}
Use Little's law to see that $\E{L_Q} = \lambda \E{W_Q}$. Substitute this in~(\ref{eq:24}) and simplify.
\end{hint}
\begin{solution}
With  Little's law $\E{L_Q} = \lambda \E{W_Q}$. Using this,
\begin{equation*}
  \E{W_Q} = \E{S_r} + \lambda \E{W_Q} \E S  =\E{S_r} + \rho \E{W_Q},
\end{equation*}
since $\rho=\lambda \E S$. But this gives for the $M/G/1$ queue that
\begin{equation*}
  \E{W_Q} = \frac{\E{S_r}}{1-\rho}.
\end{equation*}
\end{solution}
\end{exercise}

For the $M/M/1$ queue the situation becomes significantly simpler as then the service times are exponential, hence memoryless, which implies that $\E{S_r\given S_r>0} = \E S$.

\begin{exercise}[\faFlask]
Explain for the $M/M/1$ queue that 
\begin{equation}\label{eq:wqes}
  \E{W_Q} = \E L \E S.
\end{equation}
Why is this \emph{not} true in general for the $M/G/1$ queue? 
\begin{hint}
  Depart from~\eqref{eq:24}.
\end{hint}
  \begin{solution}
    By the memoryless property of the (exponential) distributed service times of the $M/M/1$ queue, the duration of a job in service, if any, is $\Exp(\mu)$ also at an arrival moment.
    Therefore, at an arrival moment, all jobs in the system (whether in service or not) have the same expected duration.
    Hence, the expected time to spend in queue is the expected number of jobs in the system times the expected service time of each job, i.e., $\E{W_q} = \E L \E S$.
    Note that we use PASTA to see that the expected number of jobs in the system at an arrival is $\E{L}$.

For the $M/G/1$ queue, the job in service (if any) does not have the same distribution as a job in queue. Hence, the expected time in queue is not $\E L \E S$. 
  \end{solution}
\end{exercise}

\begin{exercise}[\faFlask]
Use Little's law to show for the $M/M/1$ queue that 
\begin{equation}\label{eq:ew}
  \E W = \frac{\E S}{1-\rho}.
\end{equation}
\begin{hint}
  Apply Little's law to $\E W = \E L \E S + \E S$. 
\end{hint}
\begin{solution}
\begin{align*}
  \E W &= \E L \E S + \E S = \lambda \E W \E S + \E S= \rho \E W + \E S. 
\end{align*}
\end{solution}
\end{exercise}



\begin{exercise}[\faCalculator]
  Show for the $M/M/1$ queue that
  \begin{align*}
\E L &= \frac\rho{1-\rho}, & \E{L_Q} &= \frac{\rho^2}{1-\rho}, & \E{L_s} &= \rho.
  \end{align*}
  \begin{hint}
    Apply Little's law to the $\E{L_Q}$ and so on, and use the earlier expressions for $\E{W_Q}$ and so on.
  \end{hint}
  \begin{solution}
With Little's law, 
\begin{equation*}
  \begin{split}
    \E L &= \lambda \E W = \frac{\lambda \E S}{1-\rho} = \frac\rho{1-\rho}, \\
    \E{W_q} &= \E W - \E S = \frac{\E S}{1-\rho} - \E S = \frac{\rho}{1-\rho} \E S,\\
  \E{L_Q} &= \lambda \E{W_Q} = \frac{\rho^2}{1-\rho}, \\
  \E{L_s} &= \E L - \E{L_Q} = \frac{\rho}{1-\rho} - \frac{\rho^2}{1-\rho} = \rho, 
      \end{split}
\end{equation*}
since the expected number of jobs in service $\E{L_s}$ is
equal to the expected number of busy servers.
  \end{solution}
\end{exercise}


\begin{exercise}[\faFlask]  Explain that for the $M/M/1$ queue 
$\E{L_Q} = \sum_{n=1}^\infty (n-1)\pi(n)$ and  use this to find that $\E{L_Q}=\rho^2/(1-\rho)$.
  \begin{solution}
    The fraction of time the system contains $n$ jobs is $\pi(n)$ (by
    PASTA). When the system contains $n>0$ jobs, the number in queue
    is one less, i.e., $n-1$.

    \begin{equation*}
      \begin{split}
\E{L_Q} 
&= \sum_{n=1}^\infty (n-1)\pi(n) 
= (1-\rho)\sum_{n=1}^\infty (n-1) \rho^n\\
&= \rho (1-\rho)\sum_{n=1}^\infty (n-1) \rho^{n-1}
= \rho \sum_{n=1}^\infty (n-1) \pi(n-1)\\
&= \rho \sum_{n=0}^\infty n \pi(n)
= \rho \frac{\rho}{1-\rho}.
      \end{split}
    \end{equation*}

Another way to get the same result is by splitting: 
\begin{equation*}
  \begin{split}
\E{L_Q} 
&= \sum_{n=1}^\infty (n-1)\pi(n) 
=\sum_{n=1}^\infty n\pi(n) -\sum_{n=1}^\infty \pi(n)\\
&= \E L - (1-\pi(0)) = \E L - \rho.
  \end{split}
\end{equation*}
  \end{solution}
\end{exercise}

The problems below illustrate how to use Little's law and PASTA to analyze numerous queueing situations\footnote{When a problem is mainly of a computational type, I coded the solutions and show you all the steps in between so that you can check each step in your computations.
As the code is typically nearly identical to the mathematical formulas, you should not have any difficulty understanding the code.
(In the computations below I typically use the simplest, but often not the most efficient, code.)}.

\begin{exercise}[\faPhoto](Hall 5.2) \label{exer: Hall} After observing a single-server queue for several days, the following steady-state probabilities have been determined: $p(0)=0.4$, $p(1) = 0.3$, $p(2)=0.2$, $p(3)=0.05$ and $p(4)=0.05$.
  The arrival rate is 10 customers per hour.
  \begin{enumerate}
  \item Determine $\E L$ and  $\E{L_Q}$. 
  \item Using Little's formula, determine $\E W$ and $\E{W_Q}$.
\item Determine $\V{L}$ and $\V{L_Q}$.
\item Determine the service time and the utilization.
  \end{enumerate}
    \begin{solution} First find $\E L$


\begin{pyconsole}
P = [0.4, 0.3, 0.2, 0.05, 0.05]
EL = sum(n*P[n] for n in range(len(P)))
EL
\end{pyconsole}

There can only be a queue when a job is in service. Since there is
$m=1$ server, we subtract $m$ from the amount of jobs in the system.
Before we do this, we need to ensure that $n-m$ does not become
negative. Thus, $\E{L_Q} = \sum_n \max\{n-m, 0\} p(n)$.

\begin{pyconsole}
m = 1
ELq = sum(max(n-m,0)*P[n] for n in range(len(P)))
ELq
\end{pyconsole}


\begin{pyconsole}
labda = 10./60
Wq = ELq/labda # in minutes
Wq
Wq/60 # in hours

W = EL/labda # in minutes
W
W/60 # in hours
\end{pyconsole}

Let's use the standard definition of the variance, i.e., $\V X = \sum_{i} (x_i-\E X)^2 \P{X=x_i}$, for once.

\begin{pyconsole}
from math import sqrt
var_L = sum((n-EL)**2*P[n] for n in range(len(P)))
var_L
sqrt(var_L)
\end{pyconsole}


\begin{pyconsole}
var_Lq = sum((max(n-m,0)-ELq)**2*P[n] for n in range(len(P)))
var_Lq
sqrt(var_Lq)
\end{pyconsole}


\begin{pyconsole}
mu = 1./(W-Wq)
1./mu # in minutes

rho = labda/mu
rho
\end{pyconsole}

\begin{pyconsole}
rho = EL-ELq
rho
\end{pyconsole}
This checks with  the previous line.

The utilization must also by equal to the fraction of time the server is busy. 
\begin{pyconsole}
u = 1 - P[0]
u
\end{pyconsole}

Yet another way: Suppose we have $m$ servers. If the system is empty,
all $m$ servers are idle. If the system contains one customer, $m-1$
servers are idle. Therefore, in general, the average fraction of time
the server is idle is
\begin{equation*}
1- u = \sum_{n=0}^\infty \max\{n-m, 0\}  p_n,
\end{equation*}
as in the case there are more than $m$ customers in the system, the
number of idle servers is $0$.


\begin{pyconsole}
idle = sum( max(m-n,0)*P[n] for n in range(len(P)))
idle
\end{pyconsole}

   \end{solution}
 
\end{exercise}

\begin{exercise} [\faPhoto]
  (Hall 5.5) An $M/M/1$ queue has an arrival rate of 100 per hour and a service rate of 140 per hour.
  What is $p(n)$?
  What are $\E{L_Q}$ and $\E L$?
\begin{solution}
First, $p(n) = (1-\rho)\rho^n$. Now,

\begin{pyconsole}
labda = 100. # per hour
mu = 140. # per hour
ES = 1./mu
rho = labda/mu
rho 
1-rho

L = rho/(1.-rho)
L
Lq = rho**2/(1.-rho)
Lq

W = 1./(1.-rho) * ES
W
Wq = rho/(1.-rho) * ES
Wq
\end{pyconsole}

  \end{solution}
\end{exercise}

\begin{exercise}[\faPhoto](Hall, 5.6)
  An $M/M/1$ queue has been found to have an average waiting time in queue of 1 minute. The arrival rate is known to be 5 customers per minute.
 What are the service rate and utilization? Calculate $\E{L_Q}$,  $\E L$ and $\E W$. Finally, 
 the queue operator would like to provide chairs for waiting customers. He would like to have a sufficient number so that all customers can sit down at least 90 percent of the time. How many chairs should he provide?

 \begin{hint}
$\E{L_Q}$ follows right away from an application of Little's law. For the other quantities we need to find $\E S$.  One can use that 
\begin{equation*}
\E{W_Q}= \E L \E S = (\E{L_Q} + \E{L_S}) \E S = (\E{L_Q} + \lambda \E{S})\E{S}.
\end{equation*}


Now $\lambda$ and $\E{W_Q}=1$ are given, and $\E{L_Q}$ has just been computed. Hence, $\E{S}$ (which is the unknown here) can computed with the quadratic formula.

Another way is to realize that, for the $M/M/1$-queue,  $\E{W_Q} = \frac{1}{\lambda}\frac{\rho^2}{1-\rho}$. Then solve for $\rho$, and since $\lambda$ is known, $\E S$ follows. 
 \end{hint}
    \begin{solution}


 $\E{W_Q} = \frac{1}{\lambda}\frac{\rho^2}{1-\rho}$. Since
        $\E{W_Q}$ and $\lambda$ is given we can use this formula to
        solve for $\rho$ with the quadratic formula (and using that
        $\rho > 0$):

\begin{pyconsole}
labda = 5. # per minute
Wq = 1.
a = 1.
b = labda*Wq
c = -labda*Wq
rho = (-b + sqrt(b*b-4*a*c))/(2*a)
rho 

ES = rho/labda
ES
\end{pyconsole} 


\begin{pyconsole}
Lq = labda*Wq
Lq

W = Wq + ES
W

L = labda*W
L
\end{pyconsole} 


The next problem is to find $n$ such that
      $\sum_{j=0}^n p_j > 0.9$.

\begin{pyconsole} 
total = 0. 
j = 0
while total <= 0.9:
   total += (1-rho)*rho**j
   j += 1

total
j
n = j- 1 # the number of chairs 
\end{pyconsole} 

Observe that $j$ is one too high once the condition is satisfied, thus subtract one.

As a check, I use that $(1-\rho) \sum_{j=0}^n \rho^j = 1-\rho^{n+1}$.

\begin{pyconsole}
1-rho**(n) #  this must be too small.
1-rho**(n+1) # this must be OK.
\end{pyconsole} 

And indeed, we found the right $n$.

    \end{solution}
\end{exercise}

\begin{exercise}[\faPhoto]
  (Hall 5.7). A single-server queueing system is known to have Poisson
  arrivals and exponential service times. However, the arrival rate
  and service time are state dependent. As the queue becomes longer,
  servers work faster, and the arrival rate declines, yielding the
  following functions (all in units of number per hour):
  $\lambda(0) = 5$, $\lambda(1)=3$, $\lambda(2)=2$,
  $\lambda(n)=0, n\geq 3$, $\mu(0) = 0$, $\mu(1)=2$, $\mu(2)=3$, $\mu(n)=4, n\geq 3$. 
Calculate the state probabilities, i.e., $p(n)$ for $n=0,\ldots$
\begin{hint}
Use the level-crossing equations of the $M(n)/M(n)/1$ queue.
\end{hint}
    \begin{solution}
      Follows right away from the hint.
    \end{solution}
\end{exercise}

\begin{exercise}[\faPhoto]
  (Hall 5.14) An airline phone reservation line has one server and a buffer for two customers.
  The arrival rate is 6 customers per hour, and a service rate of just 5 customers per hour.
  Arrivals are Poisson and service times are exponential.
  Estimate $\E{L_Q}$ and the average number of customers served per hour.
  Then, estimate $\E{L_Q}$ for a buffer of size~5.
  What is the impact of the increased buffer size on the number of customers served per hour?
  \begin{hint}
This is a queueing system with loss, in particular the $M/M/1/1+2$ queue.
  \end{hint}
    \begin{solution}
First compute $\E{L_Q}$ for the case with a buffer for $2$ customers.

\begin{pyconsole}
labda = 6.
mu = 5.
rho = labda/mu
c = 1
b = 2
\end{pyconsole} 

Set $p(n) = \rho^n$ initially, and normalize later. Use the
expressions for the $M(n)/M(n)/1$ queue.  Observe that $\rho>1$. Since
the size of the system is $c+b+1$ is finite, all formulas work for
this case too.


There are 4 states in total: $0,1,2,3$. (The reason to import \pyv{numpy} here and convert the lists to arrays is to fix the output precision to 3, otherwise we get long floats in the output.)

\begin{pyconsole}
import numpy as np
np.set_printoptions(precision=3)

P = np.array([rho**n for n in range(c+b+1)])
P

G = sum(P)
G

P /= G # normalize
P
\end{pyconsole} 

\begin{pyconsole}
L = sum(n*P[n] for n in range(len(P)))
L

Lq = sum((n-c)*P[n] for n in range(c,len(P)))
Lq
\end{pyconsole} 


The number of jobs served per hour must be equal to the number of jobs
accepted, i.e., not lost. The fraction of customers lost is equal to
the fraction of customers that sees a full system.

\begin{pyconsole}
lost = labda*P[-1] # the last element of P
lost

accepted = labda*(1.-P[-1]) # rate at which jobs are accepted
accepted
\end{pyconsole}  

Now increase the buffer $b$ to 5.

\begin{pyconsole}
b = 5
P = np.array([rho**n for n in range(c+b+1)])
P
G = sum(P)
G

P /= G # normalize
P

L = sum(n*P[n] for n in range(len(P)))
L

accepted = labda*(1.-P[-1])
accepted
\end{pyconsole}      
    \end{solution}
\end{exercise}

\begin{exercise}[\faPhoto](Hall 5.3) After observing a queue with two servers
  for several days, the following steady-state probabilities have been
  determined: $p(0)=0.4$, $p(1) = 0.3$, $p(2)=0.2$, $p(3)=0.05$ and
  $p(4)=0.05$. The arrival rate is 10 customers per hour.
  \begin{enumerate}
  \item Determine $\E L$ and  $\E{L_Q}$. 
  \item Using Little's formula, determine $\E W$ and $\E{W_Q}$. 
  \item Determine $\V L$ and $\V{L_Q}$.
  \item Determine the service time and the utilization.
  \end{enumerate}
  \begin{solution}
 Determine $\E L$ and  $\E{L_Q}$. 

\begin{pyconsole}
P = [0.4, 0.3, 0.2, 0.05, 0.05]

c = 2
Lq = sum((n-c)*P[n] for n in range(c,len(P)))
Lq

L= sum(n*P[n] for n in range(len(P)))
L
\end{pyconsole}

 Using Little's formula, determine $\E W$ and $\E{W_Q}$. 
\begin{pyconsole}
labda = 10./60
Wq = Lq/labda # in minutes
Wq
Wq/60 # in hours

W = L/labda
W
\end{pyconsole} 

 Determine $\V L$ and $\V{L_Q}$.
\begin{pyconsole}
from math import sqrt
var_L = sum((n-L)**2*P[n] for n in range(len(P)))
var_L
sqrt(var_L)
\end{pyconsole}

\begin{pyconsole}
var_Lq = sum((max(n-c,0)-Lq)**2*P[n] for n in range(len(P)))
var_Lq
\end{pyconsole}

Determine the service time and the utilization.
\begin{pyconsole}
mu = 1./(W-Wq)
1./mu # in minutes

rho = labda/mu
rho
\end{pyconsole}

\begin{pyconsole}
rho = EL-ELq
rho
\end{pyconsole}
This checks the previous line.

The utilization must also by equal to the fraction of time the server is busy. 
\begin{pyconsole}
u = 1 - P[0]
u
\end{pyconsole}
    \end{solution}
\end{exercise}  

\begin{exercise}[\faPhoto]
  (Hall 5.8) The queueing system at a fast-food stand behaves in a peculiar fashion.
  When there is no one in the queue, people are reluctant to use the stand, fearing that the food is unsavory.
  People are also reluctant to use the stand when the queue is long.
  This yields the following arrival rates (in numbers per hour): $\lambda(0) = 10$, $\lambda(1)=15$, $\lambda(2)=15$, $\lambda(3)=10$, $\lambda(4)=5$, $\lambda(n)=0, n\geq 5$.
  The stand has two servers, each of which can operate at 5 per hour.
  Service times are exponential, and the arrival process is Poisson.
  Calculate the steady state probabilities.
  Next, what is the average arrival rate?
  Finally, determine $\E L$, $\E{L_Q}$, $\E W$ and $\E{W_Q}$.
  \begin{solution}
First the service rates.
\begin{pyconsole}
import numpy as np
labda = [10., 15., 15., 10., 5.]
c = 2
mn = 2*np.ones(len(labda)+1, dtype=int)  # number of active servers
mn[0] = 0  # no service if system is empty
mn[1] = 1  # one busy server if just one job present
mu = 5*mn # service rate is 5 times no of active servers
mu
\end{pyconsole}

Since there can be arrivals in states $0,\ldots, 4$,  the system can contain $0$ to $5$ customers, i.e., $p(0),\ldots, p(5)$.

Use the level crossing result for the $M(n)/M(n)/1$ queue:

\begin{pyconsole}
P = [1]*(len(labda)+1)
for i in range(1,len(P)):
    P[i] = labda[i-1]/mu[i]*P[i-1]

P = np.array(P) # unnormalized probabilities
P
\end{pyconsole}

\begin{pyconsole}
G = sum(P) # normalization constant
G
P /= G # normalize
P 
\end{pyconsole} 

$\lambda = \sum_{n}\lambda(n) p(n)$.

\begin{pyconsole}
labdaBar = sum(labda[n]*P[n] for n in range(len(labda)))
labdaBar
\end{pyconsole}


The average number in the system is: 

\begin{pyconsole}
Ls = sum(n*P[n] for n in range(len(P)))
Ls
\end{pyconsole}


The average number in queue: 
\begin{pyconsole}
c = 2
Lq = sum((n-c)*P[n] for n in range(c,len(P)))
Lq
\end{pyconsole} 

And now the waiting times:

\begin{pyconsole}
Ws = Ls/labdaBar
Ws # time in the system

Wq = Lq/labdaBar
Wq # time in queue
\end{pyconsole} 

    \end{solution}
\end{exercise}

\begin{exercise}[\faPhoto]
  (Hall 5.10) A repair/maintenance facility would like to determine
  how many employees should be working in its tool crib. The service
  time is exponential, with mean 4 minutes, and customers arrive by a
  Poisson process with rate 28 per hour. The customers are actually
  maintenance workers at the facility, and are compensated at the same
  rate as the tool crib employees.
 What is $\E W$ for $c=1, 2, 3$, or $4$ servers? How many employees should work in the tool crib?
  \begin{hint}
Realize that we have to control the number of servers. Hence,
    we are dealing with a multi-server queue, i.e., the $M/M/c$
    queue. Use the formulas of Eq.~\eqref{eq:9}.

The remark that maintenance workers are compensated at the same rate
as the tool crib workers confused me a bit at first.  Some thought
revealed that the consequence of this remark is that is it just as
expensive to let the tool crib workers wait (to help maintenance
workers) as to let the maintenance workers wait for tools. (Recall, in
queueing systems always somebody has to wait, either the customer in queue or
the server being idle. If it is very expensive to let customers wait, the number
of servers must be high, whereas if servers are relatively expensive, customers have to do the waiting.)
  \end{hint}
  \begin{solution}

      Would one server/person do? 
\begin{pyconsole}
labda = 28./60 # arrivals per minute
ES = 4.
labda*ES
\end{pyconsole} 

If $c=1$, the load $\rho=\lambda \E S/c >1$ is clearly undesirable for one server.  We need at
least two servers.

It is not relevant to focus on the time in the system, as time
  in service needs to be spent anyway. Hence, we focus on the waiting
  time in queue.


I just convert the formulas of~\eqref{eq:9} to Python code. This saves
me time during the computations.

\begin{pyconsole}
def WQ(c, labda, ES):
    rho = labda*ES/c
    G = sum([(c*rho)**n/factorial(n) for n in range(c)])
    G += (c*rho)**c/(1.-rho)/factorial(c)
    Lq = (c*rho)**c/(factorial(c)*G) * rho/(1.-rho)**2
    return Lq/labda # Wq, Little's law

\end{pyconsole} 

Considering the scenario with one server is superfluous as $\rho>1$ in
that case.

What is the waiting time for $c=2$ servers?

\begin{pyconsole}
WQ(2, 28./60, 4) # in minutes
WQ(2, 28./60, 4)/60. # in hours
\end{pyconsole}

What is the waiting time for $c=3$ servers?

\begin{pyconsole}
WQ(3, 28./60, 4)   # in minutes
WQ(3, 28./60, 4)/60. # in hours
\end{pyconsole}


What is the waiting time for $c=4$ servers?

\begin{pyconsole}
WQ(4, 28./60, 4) # in minutes
WQ(4, 28./60, 4)/60. # in hours
\end{pyconsole} 

In the next  part of the question we will interpret these numbers.

Since both types of workers cost the same amount of money per unit
time, it is best to divide the amount of waiting/idleness equally over
both types of workers.  I am inclined to reason as follows. The
average amount of waiting time done by the maintenance workers per
hour is $\lambda \E{W_Q}$. To see this, note that maintenance workers arrive at rate $\lambda$, and each worker waits on average $\E{W_Q}$ minutes. Thus, worker time is wasted at rate $\lambda \E{W_Q}$. Interestingly, with Little's law, $\E{L_Q}=\lambda \E{W_Q}$, i.e., the rate at which workers waste capacity (i.e.  waiting in queue) is $\E{L_Q}$. On the other hand, the  rate of work capacity wasted by the tool crib employees being idle is $c-\lambda \E{S}$, as $\lambda \E S$ is the average number of servers busy, while $c$ crib servers are available.

As both types of
employees are equally expensive, we need to choose $c$ such that
the number of maintenance workers waiting (i.e., being idle because they are waiting in queue), is  equal to the number of crib workers being idle. In other words, we search for a $c$ such that $\E{L_Q} \approx c- \lambda \E S$ (where, of course, $\E{L_Q}$ depends on $c$).


\begin{pyconsole}
labda = 28./60
ES = 4.
c = 2
ELQ = labda*WQ(c, labda, ES)
ELQ
c-labda*ES
\end{pyconsole} 
Now the maintenance employees wait more than the tool crib employees.

\begin{pyconsole}
c = 3
ELQ = labda*WQ(c, labda, ES)
ELQ
c-labda*ES
\end{pyconsole} 

\begin{pyconsole}
c = 4
ELQ = labda*WQ(c, labda, ES)
ELQ
c-labda*ES
\end{pyconsole} 

Clearly, $c=3$ should do.
    \end{solution}
\end{exercise}

\begin{exercise}[\faPhoto\/ Hall 5.22].
  At a large hotel, taxi cabs arrive at a rate of 15 per hour, and parties of riders arrive at the rate of 12 per hour.
  Whenever taxicabs are waiting, riders are served immediately upon arrival.
  Whenever riders are waiting, taxicabs are loaded immediately upon arrival.
  A maximum of three cabs can wait at a time (other cabs must go elsewhere).
  \begin{enumerate}
  \item Let $p_{ij}$ be the steady-state probability of there being $i$ parties of riders and $j$ taxicabs waiting at the hotel.
    Write the state transition equation for the system.
  \item Calculate the expected number of cabs waiting and the expected number of parties waiting.
  \item Calculate the expected waiting time for cabs and the expected waiting time for parties. (For cabs, compute the average among those that do not go elsewhere.)
  \item In words, what would be the impact of allowing four cabs to wait at a time?
  \end{enumerate}
This is really a neat problem. Please spend serious time on it to
solve before looking at the answer. 
    \begin{solution}
      Let $p_{ij}$ be the fraction of time that the system contains $i$ riders and $j$ taxi cabs.
      I assume that all members of a party of riders can be served by a single cab (that is, the parties do not exceed the capacity of a cab and all members of a party have the same destination).
      For clarity, write $\mu$ for the rate at which cabs arrive, and $\lambda$ for the arrival rate of parties of riders.
      Then the transitions are as in the figure below.
      Suppose first that there are $3$ taxi cabs.
      When a group arrives (at rate $\lambda$), there is one taxi less, and so on, until there are no more taxis left.
      Finally, if yet more groups arrive, they have to wait.
      When a new taxi arrives, the number of groups is reduced by one, and so on, until there are $3$ taxis waiting and no groups of people.


    \begin{center}

\begin{tikzpicture}[->,>=stealth',shorten >=1pt,auto,node distance=1.8cm,
                    semithick]
  \node[state] (0) {$p(0,3)$} ;
  \node[state] (1) [right of=0] {$p(0,2)$};
  \node[state] (2) [right of=1] {$p(0,1)$};
  \node[state] (3) [right of=2] {$p(0,0)$};
  \node[state] (4) [right of=3] {$p(1,0)$};
  \node[state] (5) [right of=4] {$p(2,0)$};
  \node[state] (6) [right of=5] {$p(\cdot, 0)$};

\path 
 (0) edge [bend left] node {$\lambda$} (1)
 (1) edge [bend left] node {$\mu$} (0)
 (1) edge [bend left] node {$\lambda$} (2)
 (2) edge [bend left] node {$\mu$} (1)
 (2) edge [bend left] node {$\lambda$} (3)
 (3) edge [bend left] node {$\mu$} (2)
 (3) edge [bend left] node {$\lambda$} (4)
 (4) edge [bend left] node {$\mu$} (3)
 (4) edge [bend left] node {$\lambda$} (5)
 (5) edge [bend left] node {$\mu$} (4)
 (5) edge [bend left] node {$\lambda$} (6)
 (6) edge [bend left] node {$\mu$} (5)
;
\end{tikzpicture}
      
    \end{center}

From this figure, we see that
\begin{align*}
\lambda p_{0,3} &= \mu p_{0,2} \\
(\lambda+\mu) p_{0,2} &= \mu p_{0,1} + \lambda p_{0,3}\\
(\lambda+\mu) p_{0,1} &= \mu p_{0,0} + \lambda p_{0,2}\\
(\lambda+\mu) p_{0,0} &= \mu p_{1,0} + \lambda p_{0,1}\\
(\lambda+\mu) p_{1,0} &= \mu p_{2,0} + \lambda p_{0,0}\\
(\lambda+\mu) p_{2,0} &= \mu p_{3,0} + \lambda p_{1,0}\\
\end{align*}
and so on. Thus, it is left to compute $p_{ij}$. Observe from this
scheme, or the above figure, that the situation with the taxi's
correspond to an $M/M/1$ queue, only the states have a `different
name'. Let $q$ be the number of jobs in an M/M/1 queue. Some thought
will reveal that the queueing system with cabs and parties can be
mapped to an equivalent M/M/1 queueing system. In fact, consider the
following table
\begin{center}
\begin{tabular}{ccc}
$j$ & $i$ & $q$\\
3&         0 &         0\\
2 &        0&          1\\
1 &        0&          2\\
0&         0&          3\\
0&         1&          4\\
0&         2&          5\\
\end{tabular}
\end{center}
and so on. Therefore, in general, it must be that 

\begin{equation*}
q = 3 - j +i.
\end{equation*}
From the M/M/1 queue we know right away that $p_q = \rho^q
(1-\rho)$.  With the above relation we can therefore immediately find
that $p_{ij} = \rho^{3-j+i}(1-\rho)$, save that $i$ and
$j$ must satisfy the constraints imposed by the model.

Second, the expected number of cabs waiting must be 
\begin{equation*}
1p_{0,1} + 2 p_{0,2} + 3p_{0,3}
\end{equation*}
and the expected number of parties waiting must be $\sum_{j=1}^\infty j p_{j,0}$.

\begin{pyconsole}
labda = 12. # per hour
mu = 15. # per hour
rho = labda/mu

def p(i,j):
    q  = 3 - j + i
    return rho**q*(1.-rho)

\end{pyconsole}
Expected number of  cabs waiting:
\begin{pyconsole}
Lc = sum(j*p(0,j) for j in range(0,4)) 
# Recall this sums up to 4, not including 4
Lc
  
\end{pyconsole}


To compute the expected number of parties waiting we formally have to
sum to infinity. Rather than doing the algebra, I chose to truncate
the summation at an $i$ such that $\rho^i \ll 1$, i.e.,
negligible.  Truncating at 30 seems reasonable enough:

\begin{pyconsole}
trunc = 30
rho**trunc
\end{pyconsole}

At second thought this is not yet really small. 

\begin{pyconsole}
trunc = 50
rho**trunc
\end{pyconsole}


This is better. Now go for what we want to know:

\begin{pyconsole}
Lp = sum(i*p(i,0) for i in range(trunc))
Lp
\end{pyconsole}

For the last part: This is tricky. I first, naively, computed $W_q = L_c/\mu$. This
seems to make sense, as cabs arrive at rate $\mu$, so that this
expression follows from a standard application of Little's
law. However, this is wrong, of course. When using Little's law to
relate the number of jobs in queue (i.e., in the M/M/1 queue) and the
queueing time we need to use $\lambda$, not
$\mu$. Similarly (and more formally by the mapping developed in
part a), for our cab system we also need to use $\lambda$.

\begin{pyconsole}
Wq = Lc/labda
Wq
\end{pyconsole}

Thinking in templates is often useful, but makes one sloppy\ldots

What would be the impact of allowing 4 cabs? Funny question, and with the above, trivial to answer.

\begin{pyconsole}
def p(i,j):
    q  = 4 - j + i
    return rho**q*(1.-rho)
  
\end{pyconsole}

\begin{pyconsole}
Lc = sum(j*p(0,j) for j in range(0,4))
Lc

Lp = sum(i*p(i,0) for i in range(trunc))
Lp
  
\end{pyconsole}
    \end{solution}
\end{exercise}



\opt{solutionfiles}{
\Closesolutionfile{hint}
\Closesolutionfile{ans}
\subsection*{Hints}
\input{hint}
\subsection*{Solutions}
\input{ans}
}

%\clearpage


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../queueing_book"
%%% End:
